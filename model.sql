-- DDL SISTEMA NOVO PROTOCOLO

-- SETOR

CREATE TABLE USRDBVAH.TB_NPTC_SETOR
( CD_SETOR NUMBER(*) PRIMARY KEY NOT NULL,
  NM_SETOR VARCHAR2(100),
  CD_NIVEL NUMBER(1),
  CD_SETOR_MV NUMBER(*),
  CONSTRAINT FK_NPTC_SETOR_1 FOREIGN KEY (CD_SETOR_MV) REFERENCES DBAMV.TB_SETOR (CD_SETOR)
);

CREATE SEQUENCE USRDBVAH.SEQ_NPTC_SETOR;

-- USUÁRIO

CREATE TABLE USRDBVAH.TB_NPTC_USUARIO
( ID NUMBER(*) PRIMARY KEY NOT NULL,
  DS_LOGIN VARCHAR2(75),
  NM_TITULO VARCHAR2(200),
  CD_ROLE NUMBER(1),
  CD_SETOR NUMBER(*),
  CONSTRAINT FK_NPTC_USUARIO_1 FOREIGN KEY (CD_SETOR) REFERENCES USRDBVAH.TB_NPTC_SETOR (CD_SETOR)
);

CREATE SEQUENCE USRDBVAH.SEQ_NPTC_USUARIO;

-- PROTOCOLO

CREATE TABLE USRDBVAH.TB_NPTC_PROTOCOLO
(
  ID NUMBER(*) PRIMARY KEY NOT NULL,
  CD_ATENDIMENTO NUMBER(*),
  CD_STATUS NUMBER(2),
  CD_REG_FAT NUMBER(*),
  CD_SETOR_ORIGEM NUMBER(*),
  CD_SETOR_DESTINO NUMBER(*),
  ID_PROTOCOLO_PAI NUMBER(*),
  DT_ENVIO DATE,
  DT_RESPOSTA DATE,
  SN_REENVIADO VARCHAR2(1),
  SN_ARQUIVADO VARCHAR2(1),
  CONSTRAINT FK_NPTC_PROTOCOLO_1 FOREIGN KEY (CD_SETOR_ORIGEM) REFERENCES USRDBVAH.TB_NPTC_SETOR (CD_SETOR),
  CONSTRAINT FK_NPTC_PROTOCOLO_2 FOREIGN KEY (CD_SETOR_DESTINO) REFERENCES USRDBVAH.TB_NPTC_SETOR (CD_SETOR),
  CONSTRAINT FK_NPTC_PROTOCOLO_3 FOREIGN KEY (CD_ATENDIMENTO) REFERENCES DBAMV.TB_ATENDIME (CD_ATENDIMENTO),
  CONSTRAINT FK_NPTC_PROTOCOLO_4 FOREIGN KEY (CD_REG_FAT) REFERENCES DBAMV.REG_FAT (CD_REG_FAT),
  CONSTRAINT FK_NPTC_PROTOCOLO_5 FOREIGN KEY (ID_PROTOCOLO_PAI) REFERENCES USRDBVAH.TB_NPTC_PROTOCOLO (ID)

);

CREATE SEQUENCE USRDBVAH.SEQ_NPTC_PROTOCOLO;

-- DOCUMENTO PROTOCOLO

CREATE TABLE USRDBVAH.TB_NPTC_DOCUMENTO_PROTOCOLO
(
  ID NUMBER(*) PRIMARY KEY NOT NULL,
  CD_ITEM_PRONTUARIO NUMBER(*) NOT NULL,
  CD_TIPO NUMBER(2) NOT NULL,
  NM_DESCRICAO VARCHAR(40),
  NM_CONSELHO VARCHAR(30),
  NM_PRESTADOR VARCHAR(40),
  DT_HORA_CRIACAO DATE,
  DT_HORA_IMPRESSAO DATE
);

CREATE SEQUENCE USRDBVAH.SEQ_NPTC_DOCUMENTO_PROTOCOLO;
CREATE INDEX USRDBVAH.IDX_NPTC_DOCUMENTO_PROTOCOLO ON USRDBVAH.TB_NPTC_DOCUMENTO_PROTOCOLO (CD_ITEM_PRONTUARIO, CD_TIPO);

-- ITEM  PROTOCOLO

CREATE TABLE USRDBVAH.TB_NPTC_IT_PROTOCOLO
(
  ID NUMBER(*) PRIMARY KEY NOT NULL,
  ID_PROTOCOLO NUMBER(*) NOT NULL,
  ID_DOCUMENTO NUMBER(*),
  ID_PROTOCOLO_FILHO NUMBER(*),
  CONSTRAINT FK_NPTC_IT_PROTOCOLO_1 FOREIGN KEY (ID_PROTOCOLO) REFERENCES USRDBVAH.TB_NPTC_PROTOCOLO (ID),
  CONSTRAINT FK_NPTC_IT_PROTOCOLO_2 FOREIGN KEY (ID_DOCUMENTO) REFERENCES USRDBVAH.TB_NPTC_DOCUMENTO_PROTOCOLO (ID),
  CONSTRAINT FK_NPTC_IT_PROTOCOLO_3 FOREIGN KEY (ID_PROTOCOLO_FILHO) REFERENCES USRDBVAH.TB_NPTC_PROTOCOLO (ID)
);

CREATE SEQUENCE USRDBVAH.SEQ_NPTC_IT_PROTOCOLO;

-- HISTÓRICO

CREATE TABLE USRDBVAH.TB_NPTC_HISTORICO
(
  ID NUMBER(*) PRIMARY KEY NOT NULL,
  ID_PROTOCOLO NUMBER(*),
  ID_USER NUMBER(*),
  DT_ALTERACAO DATE,
  CD_STATUS NUMBER(1),
  CONSTRAINT FK_NPTC_HISTORICO_1 FOREIGN KEY (ID_PROTOCOLO) REFERENCES USRDBVAH.TB_NPTC_PROTOCOLO (ID),
  CONSTRAINT FK_NPTC_HISTORICO_2 FOREIGN KEY (ID_USER) REFERENCES USRDBVAH.TB_NPTC_USUARIO (ID)
);

CREATE SEQUENCE USRDBVAH.SEQ_NPTC_HISTORICO;

-- COMENTARIO

CREATE TABLE USRDBVAH.TB_NPTC_COMENTARIO
(
  ID NUMBER(*) PRIMARY KEY NOT NULL,
  ID_PROTOCOLO NUMBER(*),
  ID_USER NUMBER(*),
  DT_CRIACAO DATE,
  NM_COMENTARIO VARCHAR2(255),
  CONSTRAINT FK_NPTC_COMENTARIO_1 FOREIGN KEY (ID_PROTOCOLO) REFERENCES USRDBVAH.TB_NPTC_PROTOCOLO (ID),
  CONSTRAINT FK_NPTC_COMENTARIO_2 FOREIGN KEY (ID_USER) REFERENCES USRDBVAH.TB_NPTC_USUARIO (ID)
);

CREATE SEQUENCE USRDBVAH.SEQ_NPTC_COMENTARIO;

-- CLEAR DATABASE

DROP TABLE USRDBVAH.TB_NPTC_COMENTARIO;
DROP TABLE USRDBVAH.TB_NPTC_HISTORICO;
DROP TABLE USRDBVAH.TB_NPTC_IT_PROTOCOLO;
DROP TABLE USRDBVAH.TB_NPTC_DOCUMENTO_PROTOCOLO;
DROP TABLE USRDBVAH.TB_NPTC_PROTOCOLO;
DROP TABLE USRDBVAH.TB_NPTC_USUARIO;
DROP TABLE USRDBVAH.TB_NPTC_SETOR;

DROP SEQUENCE USRDBVAH.SEQ_NPTC_COMENTARIO;
DROP SEQUENCE USRDBVAH.SEQ_NPTC_HISTORICO;
DROP SEQUENCE USRDBVAH.SEQ_NPTC_PROTOCOLO;
DROP SEQUENCE USRDBVAH.SEQ_NPTC_DOCUMENTO_PROTOCOLO;
DROP SEQUENCE USRDBVAH.SEQ_NPTC_IT_PROTOCOLO;
DROP SEQUENCE USRDBVAH.SEQ_NPTC_USUARIO;
DROP SEQUENCE USRDBVAH.SEQ_NPTC_SETOR;

